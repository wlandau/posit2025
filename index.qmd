---
format:
   revealjs:
     css: style.css
     incremental: true
     slide-number: true
     footer: "&copy; 2025 Eli Lilly and Company"
     view-distance: 100
     mobile-view-distance: 100
---

##

```{r, include = FALSE, echo = FALSE}
set.seed(0)
suppressPackageStartupMessages({
  library(targets)
})
knitr::opts_chunk$set(
  cache = FALSE,
  comment = "#>",
  echo = TRUE,
  eval = FALSE,
  fig.width = 10, 
  fig.height = 5
)
```

<style>
.reveal .tiny {
  display: inline-block;
  font-size: 0.5em;
  line-height: 1.0em;
  vertical-align: top;
}
.reveal .medium {
  display: inline-block;
  font-size: 0.75em;
  line-height: 1.5em;
  vertical-align: top;
}
</style>

<center>
<br>
<h3>A contributor-friendly dual repository<br>for R packages</h3>
<img src="./images/R-multiverse.png" height="400px">
<br>
<h4>Will Landau</h4>
</center>

# Package repositories

## Installing a package {.huge}
 
<br>

```r
install.packages(
  "crew"
)
```

## What's really happening {.huge}

<br>

```{r, `code-line-numbers` = "3"}
install.packages(
  "crew",
  repos = getOption("repos")
)
```

## Choosing a repository {.huge}

<br>

```{r, `code-line-numbers` = "3"}
install.packages(
  "crew",
  repos = "https://cloud.r-project.org"
)
```

## Choosing a repository {.huge}

<br>

```{r, `code-line-numbers` = "3"}
install.packages(
  "crew",
  repos = "https://wlandau.r-universe.dev"
)
```

<br>

:::{.nonincremental}
* R-universe: create your own repository!
:::

## Well-known repositories {.huge}

<br>

Repository | Install
---|---
CRAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | <https://cloud.r-project.org> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;

## Well-known repositories {.huge}

<br>

Repository | Install 
---|---
CRAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | <https://cloud.r-project.org> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
Bioconductor | `BiocManager::install()`

## Well-known repositories {.huge}

<br>

Repository | Install
---|---
CRAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | <https://cloud.r-project.org> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
Bioconductor | `BiocManager::install()`
R-universe | <https://ANYONE.r-universe.dev>

<br>

* Where should I <span style="font-weight: bold; color: blue;">get</span> packages?
* Where should I <span style="font-weight: bold; color: blue;">publish</span> packages?

##

<center>
<img src="./images/tug-of-war.png" width = "700px">
</center>

:::: {.columns}

::: {.column width=47%}

<center>
<h3>User want trust.</h3>
</center>

<center>
* Working packages
* Compatible dependencies
</center>

:::

::: {.column width=53%}

<center>
<h3>Contributors want ease.</h3>
</center>

<center>
* Fast submission
* Predictable outcomes
</center>

:::

::::

## Well-known repositories {.huge}

<br>

Repository | Trustworthy | Easy
---|---|---
CRAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ✅ |  ❌

## Well-known repositories {.huge}

<br>

Repository | Trustworthy | Easy
---|---|---
CRAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ✅ |  ❌
Bioconductor | ✅ |  ❌

## Well-known repositories {.huge}

<br>

Repository | Trustworthy | Easy
---|---|---
CRAN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ✅ |  ❌
Bioconductor | ✅ |  ❌
R-universe | ⚠️ | ✅ 

* R-universe repositories are usually small and specialized.
* Need to trust each maintainer of each separate repository.

## Purpose of R-multiverse {.huge}

<br>

Trustworthy | Easy
---|---
✅  | ✅ 

# R-multiverse

## What is R-multiverse?

* Dual repository
    1. Community: an <span style = "color: blue; font-weight: bold">R-universe</span> with all the latest releases.
    2. Production: quarterly snapshots of only healthy releases.

<br>

* Key features
    * Package maintainers directly control releases.
    * Transparent governance, policies, and checks.
    * High automation.

## Built with...

<center>
<img src="./images/built-with/Slide1.png">
</center>

## Built with...

<center>
<img src="./images/built-with/Slide2.png">
</center>

## Built with...

<center>
<img src="./images/built-with/Slide3.png">
</center>

## Built with...

<center>
<img src="./images/built-with/Slide4.png">
</center>

# Community repository

## Community repository

<center>
<img src="./images/community-universe.png">
</center>

* An R-universe: <https://community.r-multiverse.org>
* Latest GitHub/GitLab releases of all registered packages.

## Community repository

<center>
<img src="./images/community-universe.png">
</center>

* Middle ground between development and production.
* The "QA" (quality assurance) of R packages.

## One-time registration on GitHub {.huge}

<center>
<img src="./images/register1.png">
</center>

<br>

:::{.nonincremental}
* GitHub pull request with GitHub/GitLab URL
:::

## Automated review

<br>

<center>
<img src="./images/register2.png">
</center>

## Releases from GitHub/GitLab

<center>
<img src="./images/release.png">
</center>

* Releases pulled directly from GitHub/GitLab.
* Package maintainers have complete control!

## Installing from Community {.huge}

<br>

```{r, `code-line-numbers` = "2,4"}
install.packages(
  "webchem",
  repos = c(
    "https://community.r-multiverse.org",
    getOption("repos")
  )
)
```

# Production repository

## Production repository

* Healthy packages from Community.
* What makes a package "healthy"?
    1. Free open-source license.
    2. No [security advisories](https://github.com/RConsortium/r-advisory-database).
    3. No `ERROR`s from `WARNING`s from `R CMD check` (or `build`).
    4. Version number etiquette.
    5. Healthy dependencies.
* Requirements are transparent and achievable.
    * Incentivizes thorough testing.

## Production snapshots

<center>
<img src="./images/calendar.jpg" height="350px">
</center>

* Production is deployed 4 snapshots each year.
* Soft landing from Community to Production.

## Staging universe manages transition

<center>
<img src="./images/snapshot/Slide1.png">
</center>

## Goal: Production snapshot

<center>
<img src="./images/snapshot/Slide2.png">
</center>

## Month 1: dependency freeze

<center>
<img src="./images/snapshot/Slide3.png">
</center>

## Month 2: candidate freeze

<center>
<img src="./images/snapshot/Slide4.png">
</center>

## Month 3: Production snapshot

<center>
<img src="./images/snapshot/Slide5.png">
</center>

## Installing from Production {.production}

<br>

```{r, `code-line-numbers` = "2,4,5"}
install.packages(
  "polars",
  repos = c(
    "https://production.r-multiverse.org/2025-03-15",
    "https://packagemanager.posit.co/cran/2025-01-15"
  )
)
```

# Recap

## Summary

* Users and contributors have distinct needs.
* R-multiverse serves both.
* Maintainer-friendly approach:
    1. Easy one-time package registration.
    2. Community repository with package authors in control.
    3. Production repository with achievable requirements.

## Thanks!

* R-multiverse co-administrators: Maëlle Salmon, Charlie Gao, Jeroen Ooms.
* R-universe: Jeroen Ooms and rOpenSci.
* R Consortium:
    * R Repositories Working Group
    * ISC grant 24-ISC-1-05 (2024 H1)

## Thanks!

![](./images/slides.svg){fig-align="center"}

## Image credit {.tiny}

* <https://github.com/ropensci-org/contributing-guidance/blob/main/images/runiverse.png>
* Stefanie Butland & Steffi LaZerte (2020). rOpenSci Community Contributing Guide v0.1.0. <http://doi.org/10.5281/zenodo.4000531>
* <https://www.r-project.org/logo/>
* <https://brand.github.com/foundations/logo>
* <https://unsplash.com/photos/2-dogs-playing-on-green-grass-during-daytime-IFK5ROpTimo>
* <https://unsplash.com/photos/red-and-white-brick-wall-zb-ico2Kcg4>
* <https://unsplash.com/photos/white-printer-paperr-FoKO4DpXamQ>
