---
format:
   revealjs:
     css: style.css
     incremental: true
     slide-number: true
     footer: "&copy; 2025 Eli Lilly and Company &nbsp; &nbsp; &nbsp; &nbsp; <https://wlandau.github.io/posit2025>"
     view-distance: 100
     mobile-view-distance: 100
extensions:
  - jmbuhr/quarto-qrcode
---

##

```{r, include = FALSE, echo = FALSE}
set.seed(0)
suppressPackageStartupMessages({
  library(targets)
})
knitr::opts_chunk$set(
  cache = FALSE,
  comment = "#>",
  echo = TRUE,
  eval = FALSE,
  fig.width = 10, 
  fig.height = 5
)
```

<style>
.reveal .tiny {
  display: inline-block;
  font-size: 0.5em;
  line-height: 1.0em;
  vertical-align: top;
}
.reveal .medium {
  display: inline-block;
  font-size: 0.75em;
  line-height: 1.5em;
  vertical-align: top;
}
</style>

<center>
<h3>Hybrid publishing for R packages</h3>
<img src="./images/R-multiverse.png" height="400px">
<br>
<h4>Will Landau</h4>
</center>

# Publishing

## Central publishers

<br>

::::{.columns}

:::{.column width="33%"}

:::{.fragment}

Penguin

Oxford UP

Pearson

:::

:::

:::{.column width="33%"}

:::{.fragment}

Nature

JASA

JSS

:::

:::

:::{.column width="33%"}

:::{.fragment}

CRAN

Bioconductor

rOpenSci

:::

:::

::::

<br>

:::{.fragment}
✅  Pros: visibility for readers
:::

:::{.fragment}
❌ Cons: editorial review
:::

## Self-publishing

<br>

::::{.columns}

:::{.column width="33%"}

:::{.fragment}

Kindle Direct

Apple Books

GitHub Pages

:::

:::

:::{.column width="33%"}

:::{.fragment}

arXiv

OSF Preprints

GitHub Pages

:::

:::

:::{.column width="33%"}

:::{.fragment}

R-universe

GitHub

GitLab

:::

:::

::::

<br>

:::{.fragment}
✅ Pros: authors control publishing.
:::

:::{.fragment}
❌ : obscurity, lack of oversight
:::

## GitHub development silos

<br>

```{r}
pak::pkg_install("wlandau/crew")
```

<br>

```{r}
pak::pkg_install("stan-dev/cmdstanr")
```

## R-universe development silos

<br>

```{r}
install.packages(
  "crew",
  repos = "https://wlandau.r-universe.dev"
)
```

<br>

```{r}
install.packages(
  "cmdstanr",
  repos = "https://stan-dev.r-universe.dev"
)
```

## Hybrid publishing 

<center>
<img src="./images/R-multiverse.png" height="350px">
</center>

:::{.fragment}
✅ A centralized location for self-published releases
:::

:::{.fragment}
✅ Fully automated quality control for production 
:::

# R-multiverse

## A dual repository

<center>
<img src="./images/R-multiverse.png" height="350px">
</center>

1. Community: an R-universe repository with latest releases.
2. Production: quarterly snapshots of healthy releases.

# Community repository

## Community repository

![](./images/community-universe.png){fig-align="center"}

. . .

An R-universe repository: [community.r-multiverse.org](https://community.r-multiverse.org)

. . .

Latest GitHub/GitLab releases of all registered packages.

## Community repository

![](./images/community-universe.png){fig-align="center"}

. . .

Middle ground between development and production.

. . .  

The "QA" (quality assurance) of R packages.

## One-time registration on GitHub {.huge}

![](./images/register1.png){fig-align="center"}

<br>

## Automated review

<br>

![](./images/register2.png){fig-align="center"}

## New releases direct from maintainers

![](./images/release.png){fig-align="center"}

## Community manifest

:::{style="font-size:0.9em"}

[`packages.json`](https://github.com/r-multiverse/community/blob/main/packages.json):

```json
[
  ...,
  {
    "package": "webchem",
    "url": "https://github.com/ropensci/webchem",
    "branch": "*release"
  },
  ...
]

```

:::

## Installing from Community {.huge}

<br>

```{r, `code-line-numbers` = "2,4"}
install.packages(
  "webchem",
  repos = c(
    "https://community.r-multiverse.org",
    getOption("repos")
  )
)
```

# Production repository

## Quarterly snapshots

<center>
<img src="./images/clock.png" height="300px">
</center>

. . .

Production is deployed 4 snapshots each year.

. . .

Healthy releases from Community.

. . .

Soft landing from Community to Production.

## Automated checks

<br>

:::{.fragment}
✅ Free open-source license
:::

:::{.fragment}
✅ No security advisories
:::

:::{.fragment}
✅ `R CMD check` passes
:::

:::{.fragment}
✅ Version number increases
:::

:::{.fragment}
✅ Healthy dependencies
:::

## Staging universe manages transition

![](./images/snapshot/Slide1.png){fig-align="center"}

## Goal: Production snapshot

![](./images/snapshot/Slide2.png){fig-align="center"}

## Month 1: dependency freeze

![](./images/snapshot/Slide3.png){fig-align="center"}

## Month 2: candidate freeze

![](./images/snapshot/Slide4.png){fig-align="center"}

## Month 3: Production snapshot

![](./images/snapshot/Slide5.png){fig-align="center"}

## Installing from Production {.production}

<br>

```{r, `code-line-numbers` = "2,4,5"}
install.packages(
  "polars",
  repos = c(
    "https://production.r-multiverse.org/2025-03-15",
    "https://packagemanager.posit.co/cran/2025-01-15"
  )
)
```

# Recap

## Summary {.Huge}

<br>

Maintainers control publishing.

. . .

<br>

Users can access quality packages from one place.

. . .

<br>

We are recruiting new packages and new moderators.

## Thanks! {.medium}

::: {.nonincremental}

* R-multiverse co-administrators
    * Jeroen Ooms
    * Maëlle Salmon
    * Charlie Gao
* rOpenSci: <https://ropensci.org/about/>
* R-universe: Jeroen Ooms and rOpenSci.
* R Consortium:
    * R Repositories Working Group
    * ISC grant 24-ISC-1-05 (2024 H1)

:::

## Slides: [wlandau.github.io/posit2025](https://wlandau.github.io/posit2025)

<center>
{{< qrcode https://wlandau.github.io/posit2025 width=500 height=500 >}}
</center>

## Image credit {.tiny}

:::{.nonincremental}

* <https://github.com/ropensci/logos/blob/master/icon_lettering_color.svg>
* <https://github.com/ropensci-org/contributing-guidance/blob/main/images/runiverse.png>
* Stefanie Butland & Steffi LaZerte (2020). rOpenSci Community Contributing Guide v0.1.0. <http://doi.org/10.5281/zenodo.4000531>
* <https://unsplash.com/photos/white-printer-paperr-FoKO4DpXamQ>
* <https://unsplash.com/photos/round-analog-wall-clock-pointing-at-1009-L0xOtAnv94Y>
:::
